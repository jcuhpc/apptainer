Bootstrap: localimage
From: /gpfs01/sw/containers/ubuntu-20.04.sif

%files
/gpfs01/sw/source/DIRAC-21.1-Source.tar.gz /opt/

%runscript
exec "$@"

%post
cd /opt  &&  \
VERS=21.1  &&  \
apt-get update  &&  \
apt-get install -y hdf5-tools gfortran python-is-python2 python2  &&  \
apt-get clean  &&  apt-get purge  &&  rm -rf /var/lib/apt/lists/*  &&  \
curl https://bootstrap.pypa.io/pip/2.7/get-pip.py --output get-pip.py  &&  python get-pip.py  &&  \
tar xf DIRAC-$VERS-Source.tar.gz  &&  rm -f *.tar.gz  &&  \
mv DIRAC-$VERS-Source dirac  &&  cd dirac  &&  \
./setup  &&  cd build  &&  make -j 20  &&  \
make test

%environment
export PATH="/opt/dirac/build:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

