Bootstrap: localimage
From: /gpfs01/sw/containers/ubuntu-24.04.sif

%runscript
exec "$@"

%post
cd /opt  &&  \
VERS=5.4.1  &&  \
apt-get update  &&  \
apt install -y dos2unix  &&  \
wget https://raw.githubusercontent.com/TheComputationalPhysicist/siesta5.4.1-ubuntu24.04_setup/refs/heads/main/install_siesta_5_4_1_ubuntu24.sh  &&  \
sed -ie 's/\${HOME}\/Code\/siesta-\${SIESTA_VER}/\/opt\/siesta/' install_siesta_5_4_1_ubuntu24.sh  &&  \
sed -ie 's/\${HOME}/\/tmp/' install_siesta_5_4_1_ubuntu24.sh   &&  \
sed -ie '1s/ bash/ -S bash/' install_siesta_5_4_1_ubuntu24.sh  &&  \
sed -ie 's/sudo //g' install_siesta_5_4_1_ubuntu24.sh  &&  \
sed -ie '13d' install_siesta_5_4_1_ubuntu24.sh  &&  \
dos2unix install_siesta_5_4_1_ubuntu24.sh  &&  \
cat install_siesta_5_4_1_ubuntu24.sh  && \
chmod 700 install*.sh  &&  ./install_siesta_5_4_1_ubuntu24.sh  &&  \
apt-get clean  &&  apt-get purge  &&  rm -rf /var/lib/apt/lists/*

%environment
export PATH="/opt/siesta/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

